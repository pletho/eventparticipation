# 참여형 이벤트 시스템 전체 시나리오

## 1. 시스템 개요

* **사용자:** 이벤트 참여자, 관리자, 외부 시스템
* **목적:** 홍보이벤트 관리, 참여자 기록, 성과 분석
* **주요 컴포넌트:**

  * GNUboard 기반 관리자 시스템
  * FastAPI 기반 외부 데이터 수신 서버
  * MariaDB 데이터베이스

## 2. 시스템 구성

* **사용자 모듈:** 이벤트 참여, 게임, 결과 확인
* **관리자 모듈:** 학교/이벤트/학과/게임/사은품/참여자 관리, 리포트
* **API 서버:** FastAPI 서버 (외부 데이터 수신)

## 3. 시스템 동작 흐름

1. 사용자가 이벤트에 참여 (이름/전화번호 입력)
2. 참여 결과 기록 (DB 저장)
3. 성공 시 사은품 발송 (수량 자동 감소)
4. 관리자 페이지에서 참여자 관리 (승인/반려)
5. 리포트 페이지에서 성과 분석 (학교별/학과별 통계)
6. 외부 시스템에서 외부 데이터 수신 (FastAPI)

## 4. DB 테이블 구조

* g5\_school\_info (학교)
* g5\_event\_info (이벤트)
* g5\_department\_info (학과)
* g5\_game\_info (게임)
* g5\_gift\_info (사은품)
* g5\_event\_participant (참여자)
* g5\_event\_result (참여 결과)

## 5. FastAPI 서버 설정

* 경로: /home/deb/debkr/serv/record\_server.py
* venv 위치: /home/deb/debkr/serv/venv
* 서비스 파일: /etc/systemd/system/record\_server.service
* 포트: 18000

## 6. 외부 데이터 수신 API

* 엔드포인트: /apidata/external\_record
* 요청 방식: POST (JSON)
* 수신 데이터: 이름, 전화번호, 시간, 이벤트ID

## 7. 관리자 시스템

* 학교/이벤트/학과/게임/사은품/참여자 관리
* 성과 리포트 (학교별, 학과별 통계)

## 8. 주요 자동화 로직

* 사은품 자동 차감 (승인 시)
* 참여자 중복 방지 (전화번호 기준)
* 리포트 자동 집계 (학교/학과별)
* 외부 데이터 수신 기록


## 9. 시스템 보안 및 안정성

* HTTPS 적용 (certbot으로 SSL 인증서)
* FastAPI 서버 기본 인증 (외부 API 수신)
* systemctl로 FastAPI 서버 자동 관리

  * 서비스 파일: /etc/systemd/system/record\_server.service
  * 자동 재시작 설정 (Restart=always)

## 10. 데이터 백업 및 복원

* MariaDB 정기 백업 스크립트

  * 경로: /home/deb/backup/db\_backup.sh
  * crontab 자동 실행 (일일/주간)
* FastAPI 외부 수신 기록 파일 자동 보관

  * 경로: /home/deb/record\_external/

## 11. 관리자 시스템 상세 기능

### 학교 관리

* 학교 등록/수정/삭제
* 학교별 이벤트 연결

### 이벤트 관리

* 이벤트 등록/수정/삭제
* 기간 설정 (시작일/종료일)
* 이벤트 상태 (대기/진행중/마감)

### 학과 관리

* 학과 등록/수정/삭제
* 학교와 연결 (학교 선택)

### 게임 관리

* 게임 등록/수정/삭제
* 게임 타입 (OX, 퀴즈, 룰렛 등)

### 사은품 관리

* 사은품 등록/수정/삭제
* 재고 수량 관리

### 참여자 관리

* 참여자 리스트 확인
* 승인/반려 처리 (참여 결과)

### 성과 리포트

* 학교별/학과별 통계 그래프
* 성공/실패 비율 도넛 그래프

## 12. 성과 분석 (리포트)

* 이벤트별 전체 참여자 수
* 성공자 수, 실패자 수
* 사은품 발송 수
* 학교별 성과 (참여자 수/성공률)
* 학과별 성과 (참여자 수/성공률)

## 13. 성과 PDF 저장

* 자동 PDF 리포트 생성 (admin\_event\_report.php)
* PDF 파일명: event\_report\_YYYYMMDD.pdf
* PDF 저장 경로: /home/deb/record\_external/reports/

## 14. 외부 API 연동 계획

* 외부 시스템에서 이벤트 참여 기록 수신
* 외부 API: /apidata/external\_record
* 수신 데이터 기록 (JSON 파일 저장)
* 외부 데이터 자동 분석 (실시간 통계)


## 15. 시스템 확장 계획

* 사용자 맞춤형 이벤트 추천 (관심 학과 기반)
* 자동 참여 리포트 생성 (시간별/성공률)
* 외부 API 추가 연동 (타사 시스템 통합)
* FastAPI 서버 부하분산 (Nginx 프록시 + 멀티프로세스)

## 16. 시스템 유지보수

* 시스템 로그 모니터링 (journalctl -u record\_server.service -f)
* FastAPI 서버 오류 발생 시 자동 재시작
* MariaDB 백업 스크립트 정기 실행
* SSL 인증서 자동 갱신 (certbot)

## 17. 예상 사용 시나리오

### 관리자 사용

* 관리자 페이지 접속
* 학교/이벤트/학과/게임/사은품 등록/관리
* 참여자 승인/반려 관리
* 성과 리포트 확인
* 성과 PDF 다운로드

### 사용자 사용

* 이벤트 랜딩페이지 접속
* 이름/전화번호 입력 후 참여
* 게임 플레이 (성공/실패 결정)
* 결과 확인
* 사은품 수령 안내 (성공 시)

### 외부 시스템 사용

* 외부 API로 참여 기록 전송
* FastAPI 서버에서 기록 수신
* JSON 파일 자동 저장 (실시간 기록)

## 18. 성능 최적화

* FastAPI 서버 가상환경 (venv) 설정으로 독립 구동
* Nginx 리버스 프록시로 FastAPI 다중 접속 처리
* 시스템 자원 모니터링 (CPU/RAM)
* 성과 리포트 로딩 속도 최적화 (쿼리 캐싱)

## 19. 보안 강화

* SSL 인증 (HTTPS 적용)
* 관리자 로그인 권한 체크 (auth\_check)
* 외부 API 인증키 추가 고려
* MariaDB 사용자 권한 최소화

## 20. 차후 추가 가능 기능

* 이벤트별 실시간 성과 그래프
* 관리자 모바일 앱 (React Native 또는 Flutter)
* 실시간 알림 시스템 (참여/승인/결과)
